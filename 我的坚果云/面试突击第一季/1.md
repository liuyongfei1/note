## 面试官对于消息队列的7个连环炮

### 如果进行消息队列的技术选型

#### 1、为什么使用消息队列：

核心三点：

解耦、

异步：不使用mq会同步高延时、

削峰：没有MQ，高峰期时系统被打死的场景

#### 2、架构中引入MQ可能存在的问题

1. 系统可用性降低了，MQ 一旦故障了，系统A 就没法发送消息到MQ了，然后系统BCD也没法从MQ消费消息了；
2. 导致系统要考虑的问题变多，比如消息重复、消息丢失等，进而系统复杂性变高了；
3. 一致性问题：有人给系统给发送个请求，本来这个请求应该是系统ABCD都执行成功了才能返回的，结果系统ABC执行成功了，系统D执行失败了，结果导致整个请求给用户返回的是成功，但后台逻辑是差了点儿。

#### 3、rabbitmq、rocketmq、kafka优缺点

#### 4、如何保证消息队列的高可用

采用集群模式

##### rabbitmq的高可用性

rabbitmq的普通集群模式

rabbitmq的镜像集群模式：

  每个节点上都有queue的完整镜像（包含queue的完整数据），缺点：`不是分布式的（每个节点都持有这个queue的所有数据）`。

##### kafka的高可用性

 