### SpringBoot自动装配原理

#### spring.factories

pom.xml：

- spring-boot-dependencies：核心依赖在父工程中，管理了依赖的版本

- 启动器

  ```xml
  <dependency>
   <groupId>org.springframework.boot</groupId>
   <artifactId>spring-boot-starter</artifactId>
  </dependency>
  ```

  - 启动器说白了，就是Spring Boot的启动场景；
  - 比如说，spring-boot-starter-web，就会帮我们自动导入web环境所有的依赖；
  - springboot 会把所有的功能场景，都变成一个一个的启动器；
  - 如果我们要使用什么功能，就选择对应的启动器（starter）。

  https://www.bilibili.com/video/BV1PE411i7CV?p=6&spm_id_from=pageDriver



<img src="01.assets/image-20211208130737178.png" alt="image-20211208130737178" style="zoom:50%;" />



#### **@ConditionalOnxxx 注解**



<img src="01.assets/image-20211208131555057.png" alt="image-20211208131555057" style="zoom:80%;" />

比如这个 AopAutoConfiguration，点进去：

```java
@ConditionalOnClass({EnableAspectJAutoProxy.class, Aspect.class, Advice.class, AnnotatedElement.class})
```

如果这里面的相关类的jar包都已经导入了，因此条件都满足，**AopAutoConfiguration这个类才会生效。**

比如这个 RabbitAutoConfiguration，点进去：

```java
@ConditionalOnClass({RabbitTemplate.class, Channel.class})
```

因为我项目里没有导RabbitTemplate相关的jar包：

![image-20211208131931737](01.assets/image-20211208131931737.png)

**因此 RabbitAutoConfiguration 这个类 不会生效。**

**结论：**

Spring Boot所有自动配置都是在启动的时候扫描并加载：`spring.factories`所有的自动配置类都在这里面。

但是不一定都生效，要判断条件是否成立。

只要导入了对应的starter，就有对应的启动器了，有了启动器，我们自动装配就会生效，然后配置才会成功。

#### **总结**

1、spring boot在启动的时候，从类路径下/META-INF/spring.factories获取指定的值；

2、将这些自动配置的类导入容器，自动配置就会生效。帮我们进行自动配置；

3、以前我们需要自动配置的东西，现在spring boot帮我们做了；

4、整合java ee，解决方案和自动配置的东西都在spring-boot-autoconfigure-2.2.0.RELEASE.jar这个包下；

5、它会把所有需要导入的组件以类名的形式返回，这些组件就会被添加到容器；

6、容器中也会存在非常多的***AutoConfiguration的文件（@Bean），就是这些类给容器中导入了这个场景需要的所有组件，并自动配置，@Configuration。



