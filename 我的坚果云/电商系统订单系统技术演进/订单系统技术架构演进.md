### 生单链路Seata TA分布式事务原理分析

undo_log

全局锁

魔盒（开发协作平台）

- 项目介绍：是一套帮助数据开发人员完成离线、实时计算任务打包、测试、数据核验和发布上线等工作的一个开发协作平台。
- 项目职责：负责把控项目整体开发进度，核心流程设计、任务分工，协调项目关联方。负责Spark离线任务的项目构建功能设计、与工作流引擎Azkaban的集成、工作流的串行、并行设置；flink实时任务执行、版本回滚、重新拉起任务、任务发布上线。
- 项目背景：在没有魔盒之前，数据开发人员使用Azkaban调度Spark任务需要多次线下操作，容易出错不说，想查看代码jar包版本历史也非常不方便。在任务越来越多的时候，就会发现不易管理、不易排查问题，大大降低数据开发效率。
- 负载情况：暂时空
- 项目描述： 
  - Spark离线任务管理： 
    - - 项目构建：数据开发人员在线下用Spark 或 SparkSQL编写完分析代码后提交至git仓库，通过魔盒选择对应代码分支进行项目构建（将要构建的版本数据放入Rabbitmq消息队列、Rabbitmq消费端消费到消息后台调用Shell脚本执行Maven打包命令，通过Websocket连接向客户端实时发送过滤后的打包日志信息）、构建成功的jar包上传至hdfs集群供执行工作流时使用；
      - 创建工作流：集成Azkaban工作流调度器，格式化前端传过来的工作流数据组装出Azkaban所需要的.job资源文件、将.job文件压缩成.zip包、调用Azkaban的Restful接口，上传.zip包到Azkaban。





RocketMQ事务机制

业务队列、重试队列。

### 订单履约状态通知乱序问题

#### 消费消息时的顺序

保证 同一个订单id，各个履约状态消息 写入同一个queue里。

这样的话就能保证顺序。然后消费端消费的时候，消费到的同一个订单的消息就是有顺序性的。

#### 写消息时的顺序

更新订单数据失败，则将消费线程挂起suspend，等会儿再去消费。