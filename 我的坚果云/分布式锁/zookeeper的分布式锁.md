### zookeeper分布式锁

### 两个特性

其实是基于zookeeper的两个特性：

- 顺序节点的特性；

假如我们 /lock/ 目录下创建3个节点，zk集群会按照发起创建的顺序来创建3个节点。

节点分别为： /lock/000000001， /lock/000000002， /lock/000000003，最后一位数是依次递增的，节点名由zk来完成。

- 临时节点的特性
  zk中还有一种称为临时节点的节点，临时节点由某个客户端创建，当客户端与zk集群断开连接，该节点自动被删除。

#### 实现原理

1. 多个节点同时在一个指定节点下面创建临时顺序节点，谁创建的序号最小，谁就获得了锁；
2. 其它节点就会监听序号比自己小的节点，一旦序号比自己小的节点被删除了，其它节点就会获得相应的事件；
3. 然后查看自己是否为序号最小的节点，如果是，则获取锁。

java并发编程里

Object.wait()

notifyAll()

如果加锁的客户端宕机了，zk会感知到，因为创建的是临时节点，**zk会自动把它创建的顺序节点给删除掉**。

zk的锁，默认情况下就是公平锁。

