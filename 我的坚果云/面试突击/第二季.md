### 01、你们公司用的Dubbo？那你再额外说说Spring Cloud的核心架构原理？（上）

哪怕百万级用户，十万级日活，单块系统就不合适了。

### 01、你们公司用的Dubbo？那你再额外说说Spring Cloud的核心架构原理？（中）

### 01、你们公司用的Dubbo？那你再额外说说Spring Cloud的核心架构原理？（下）

Spring Cloud的几个核心组件：

#### 服务注册中心

##### 服务注册

有一个路由表，会存储每个服务的相关信息，比如服务名字，服务的ip地址，端口号等。

##### 服务发现

订单系统会有一个服务发现，从服务注册中心拉取路由表，从路由表里就能知道 库存系统，仓储系统分，积分系统别部署在哪台机器上，使用的哪个端口。

#### 服务调用Feign

 订单系统使用Feign的包，通知Feign，底层会把请求转化成 http 请求，把请求发送给指定机器的端口上。

调用的接口使用了 @FeignClient注解，例如：

```java
@FeignClient(value="inventory-service")
public interface InventoryService extends InventoryApi {

}
```

会生成 JDK Proxy 动态代理类实例，实现了调用接口，就会通过 InvokeHandler 调用处理器分发远程调用。

RequestTemplate，构造 Request 实例。

Feign 或找 Ribbon，Ribbon 根据负载均衡算法返回给Fegin  一个请求地址。

#### 负载均衡Ribbon

比如订单系统下载订单后，库存系统部署在多个机器上，那么怎么决定扣减库存时去请求哪台机器呢？=》 Ribbon。 

Ribbon 会从路由信息表里读取到 库存系统的两台机器的信息，然后通过负载均衡算法，选出其中1台机器，然后再交给Feign，Feign再把请求发送出去。

#### 网关Zuul

1、授权认证，过滤请求。 

2、 前端来请求服务的时候，太多服务太多接口，记录起来会很复杂。这个时候其实可以对外暴露一个网关地址，前端所有请求直接访问网关地址。

网关在收到请求后，会根据请求再路由到对应的服务。

##### 比如我们的数据巴士项目

1. 网关统一暴露的地址是：http://databus.yunzongnet.com

2. 网关zuul服务的配置文件里，会配置路由信息，如：

   ```properties
   zuul.routes.dcmq-service=/api/dcmq/**
   zuul.routes.dcdd-service=/api/dcdd/**
   zuul.routes.dchb-service=/api/dchb/**
   zuul.routes.dckf-service=/api/dckf/**
   ```

   

3. 然后 云雀数据平台调用 mysql 数据服务时，请求路径为：http://databus.yunzongnet.com/api/dcmq/query

4. 然后请求就会被 zuul 给路由到  dcmq-service 服务上，而这个 dcmq-service 就是我们部署的 mysql 数据服务的 应用名称（见 mysql服务的配置文件）：

      ```properties
spring.application.name=dcmq-service
      ```



如果让聊 Spring Cloud 的核心架构原理，其实就拿出来这几个核心组件来讲，现场画画图就可以了。