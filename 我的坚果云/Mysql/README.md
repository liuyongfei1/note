### 课程

- 第二阶段

- - 03_多场景下的企业级分布式事务技术深入底层剖析

### 事务的ACID

#### 一、原子性（atomicity)

一堆SQL，要么一起成功，要么都别执行，不允许某个sql语句执行成功了，某个sql失败了。

#### 二、一致性（consistency)

是针对数据一致性来说的。就是说一堆sql执行之前，数据必须是准确的，执行之后，数据也必须是准确的。

别搞了半天，执行完了sql，结果sql对应的数据修改没给你执行。

#### 三、隔离性（isolation）

就是说多个事务在跑的时候，不能相互干扰，别事务A操作个数据，弄到一半还没弄好呢，结果事务B来改了这个数据，导致事务A的操作出错了。

#### 四、持久性（durability）

事务执行成功了，就必须永久对数据的修改是有效的，别过了一会儿数据自己没了。

### 事务的隔离级别

#### 1.读未提交

#### 2.读已提交

#### 3.可重复读

#### 4.串行化

mysql默认的隔离级别就是 **可重复读**。就是说每个事物都会开启一个自己要操作的某个数据快照，在事务期间，读取到的都是这个数据的快照罢了，对一个数据多次读都是一样的。

mysql是怎么实现可重复读的呢？是通过mvcc多版本并发控制的机制实现的。

mysql的 innodb引擎，默认是会给每行数据加两个隐藏列，一个是创建事务id，一个是删除事务id。

且在mysql innodb引擎中，事务id是全局唯一自增的。

每个事务只能查到 创建事务 <= 当前事务的那一行；只能查到删除事务 > 自己当前事务id的那一行。

详见：第二阶段：电商系统的分布式架构实战

- 03_多场景下的企业级分布式事务技术深入底层剖析。

### Spring中事务传播特性

一共有7种事务传播行为：

### Spring中的@Transactional注解

为什么Spring中，加入一个@Transactional注解之后，为什么就可以莫名其妙的让方法支持事务了呢？

这里边主要用到了 动态代理和AOP。

spring对我们的service组件创建了一个动态代理，你加了@Transactional注解之后呢，就对这个动态代理通过AOP加入了一堆事务管理的增强逻辑：开始执行方法之前会先开启事务，方法中如果有报错就失误回滚，如果没有报错就提交事务。

#### 互联网项目里的Mysql库拆分

互联网项目中用户量增长及数据增长后 经常需要进行数据库的拆分。在各个服务器上安装mysql实例，在mysql中创建对应的库，一个库对应一个服务器的mysql实例。

